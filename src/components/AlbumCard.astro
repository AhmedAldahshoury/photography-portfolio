---
import { cfImageUrl } from '../utils/cfImages';

const { album } = Astro.props;
const albumDate = album.date ? new Date(album.date) : null;
const yearLabel = albumDate ? albumDate.getUTCFullYear() : 'Album';
const location = album.slug?.split('-').slice(3).join(' ');
const locationLabel = location
  ? location.replace(/\b\w/g, (char) => char.toUpperCase())
  : 'Visual Series';
const imageCount = album.imageKeys?.length ?? 0;
const frameLabel = imageCount ? `${imageCount} frame${imageCount === 1 ? '' : 's'}` : 'Gallery';
---

<a class="card" href={`/albums/${album.slug}`}>
  <img
    class="card-image"
    src={cfImageUrl(album.coverKey, { width: 700, quality: 75 })}
    alt={`${album.title} cover`}
    loading="lazy"
    decoding="async"
    width="700"
    height="467"
  />
  <div class="card-body">
    <div class="badge">{yearLabel}</div>
    <h3 style="margin-top: 0.75rem;">{album.title}</h3>
    <p style="color: var(--muted); margin-top: 0.5rem;">{locationLabel}</p>
    <p style="color: var(--muted); margin-top: 0.35rem; font-size: 0.9rem;">{frameLabel}</p>
    {albumDate && (
      <p style="color: var(--muted); margin-top: 0.5rem;">
        {albumDate.toLocaleDateString('en-US', { month: 'long', day: '2-digit', year: 'numeric', timeZone: 'UTC' })}
      </p>
    )}
  </div>
</a>
