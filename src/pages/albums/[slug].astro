---
import BaseLayout from '../../layouts/BaseLayout.astro';
import albums from '../../data/albums.json';
import { buildImageUrl } from '../../utils/imageUrl';

export function getStaticPaths() {
  return albums.map((album) => ({
    params: { slug: album.slug },
    props: { album },
  }));
}

const { album } = Astro.props;
---

<BaseLayout
  title={`${album.title} â€” T7TFOS Photography`}
  description={album.description}
>
  <section class="section">
    <div class="container">
      <div class="album-hero">
        <div>
          <span class="badge">{album.location}</span>
          <h1 class="section-title" style="margin-top: 1rem;">{album.title}</h1>
          <p class="section-subtitle" style="margin-top: 1rem;">{album.description}</p>
          <p style="margin-top: 1.5rem; color: var(--muted); text-transform: uppercase; letter-spacing: 0.2em;">
            {album.year}
          </p>
        </div>
        <img
          src={buildImageUrl(album.coverImage, { width: 1400, quality: 80 })}
          alt={`${album.title} cover`}
          loading="eager"
          decoding="async"
          fetchpriority="high"
          width="1400"
          height="933"
        />
      </div>
    </div>
  </section>

  <section class="section">
    <div class="container">
      <!-- Responsive image grid with click-to-open lightbox -->
      <div class="image-grid">
        {album.images.map((image, index) => (
          <button
            type="button"
            data-lightbox-src={buildImageUrl(image, { width: 2000, quality: 82 })}
            aria-label={`Open image ${index + 1}`}
          >
            <img
              src={buildImageUrl(image, { width: 900, quality: 78 })}
              alt={`${album.title} image ${index + 1}`}
              loading="lazy"
              decoding="async"
              width="900"
              height="600"
            />
          </button>
        ))}
      </div>
    </div>
  </section>

  <!-- Lightweight lightbox overlay (no external libraries) -->
  <div class="lightbox" id="lightbox" aria-hidden="true">
    <div class="lightbox-content">
      <button type="button" id="lightbox-close">Close</button>
      <div class="lightbox-image-frame">
        <img
          id="lightbox-image"
          src=""
          alt="Expanded view"
          loading="lazy"
          decoding="async"
          width="2000"
          height="1333"
        />
      </div>
    </div>
  </div>

  <script is:inline>
    const lightbox = document.getElementById('lightbox');
    const lightboxImage = document.getElementById('lightbox-image');
    const closeButton = document.getElementById('lightbox-close');

    const openLightbox = (src) => {
      lightboxImage.src = src;
      lightbox.classList.add('is-open');
      lightbox.setAttribute('aria-hidden', 'false');
    };

    const closeLightbox = () => {
      lightbox.classList.remove('is-open');
      lightbox.setAttribute('aria-hidden', 'true');
      lightboxImage.src = '';
    };

    document.querySelectorAll('[data-lightbox-src]').forEach((button) => {
      button.addEventListener('click', () => {
        openLightbox(button.dataset.lightboxSrc);
      });
    });

    closeButton.addEventListener('click', closeLightbox);
    lightbox.addEventListener('click', (event) => {
      if (event.target === lightbox) {
        closeLightbox();
      }
    });

    document.addEventListener('keydown', (event) => {
      if (event.key === 'Escape') {
        closeLightbox();
      }
    });
  </script>
</BaseLayout>
